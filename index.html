<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>ABRdiary v.2.4.1</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --bg:#f4f6f8;
  --card:#ffffff;
  --primary:#2563eb;
  --border:#e5e7eb;
}
*{box-sizing:border-box}
body{
  margin:0;padding:16px;
  font-family:"Segoe UI",Arial,sans-serif;
  background:var(--bg);
}
.container{max-width:900px;margin:auto}
.card{
  background:var(--card);
  padding:22px;
  border-radius:14px;
  box-shadow:0 8px 20px rgba(0,0,0,.05);
  margin-bottom:20px;
}
h1{text-align:center;margin-bottom:6px}
.subtitle{text-align:center;color:#64748b;margin-bottom:16px}

/* LOGIN */
#loginScreen{
  position:fixed;
  inset:0;
  background:var(--bg);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:2000;
}
.login-box{
  max-width:360px;width:100%;
  text-align:center;
}
.login-box input{
  width:100%;
  padding:12px;
  border-radius:10px;
  border:1px solid var(--border);
  text-align:center;
  margin-bottom:14px;
}
.btn{
  background:var(--primary);
  color:white;
  border:none;
  padding:10px 16px;
  border-radius:999px;
  cursor:pointer;
  font-weight:600;
}

/* DATE TIME */
.datetime-row{
  display:flex;
  gap:16px;
  margin-bottom:14px;
}
.datetime-row input{
  border:none;
  background:transparent;
  font-weight:600;
}

/* TAG */
.tag-btn{
  display:inline-block;
  background:#e5f0ff;
  color:#1d4ed8;
  padding:6px 12px;
  border-radius:999px;
  font-size:12px;
  margin:4px;
  cursor:pointer;
}
.tag-selected{background:#1d4ed8;color:white}

/* SEARCH */
.search-label{
  font-size:13px;
  font-weight:600;
  margin-bottom:6px;
  display:block;
}
.search-box input{
  width:100%;
  padding:10px 12px;
  border-radius:10px;
  border:1px solid var(--border);
  margin-bottom:12px;
}

/* LIST */
#diaryList{
  max-height:320px;
  overflow-y:auto;
  border:1px solid var(--border);
  border-radius:12px;
  padding:10px;
}
.entry{
  border:1px solid var(--border);
  border-radius:10px;
  padding:12px;
  margin-bottom:10px;
  background:#fafafa;
  cursor:pointer;
}
.entry:hover{background:#f1f5f9}
.entry-date{
  font-size:12px;
  font-weight:600;
  color:#475569;
}
.entry-preview{
  font-size:13px;
  margin-top:6px;
}

/* MODAL */
#modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.4);
  display:none;
  align-items:center;
  justify-content:center;
}
.modal-box{
  background:white;
  max-width:520px;
  width:90%;
  border-radius:14px;
  padding:20px;
  position:relative;
}
.modal-close{
  position:absolute;
  top:10px;
  right:14px;
  cursor:pointer;
  font-size:18px;
}
</style>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>

<body>

<!-- LOGIN -->
<div id="loginScreen">
  <div class="card login-box">
    <h1>üîê ABRdiary</h1>
    <div class="subtitle">Abdul Rahim</div>
    <input type="password" id="passwordInput" placeholder="Password">
    <button class="btn" onclick="checkLogin()">Masuk</button>
  </div>
</div>

<div class="container" id="app" style="display:none">

<div class="card">
  <h1>üìò ABRdiary</h1>
  <div class="subtitle">Diary Online Abdul Rahim</div>

  <div class="datetime-row">
    <input type="date" id="diaryDate">
    <input type="time" id="diaryTime">
  </div>

  <div id="tagList"></div>
  <div id="selectedTag"></div>

  <textarea id="diaryText" placeholder="Tulis diary..."></textarea>
  <br><br>
  <button class="btn" onclick="saveDiary()">Simpan Diary</button>
</div>

<div class="card">
  <h3>üìö Daftar Diary</h3>

  <!-- üîç SEARCH (PASTI MUNCUL) -->
  <label class="search-label">Cari Diary</label>
  <div class="search-box">
    <input type="text" id="searchInput" placeholder="Ketik kata kunci..." onkeyup="loadDiary()">
  </div>

  <div id="diaryList"></div>
</div>

</div>

<!-- MODAL -->
<div id="modal">
  <div class="modal-box">
    <span class="modal-close" onclick="modal.style.display='none'">√ó</span>
    <div id="modalContent"></div>
    <br>
    <button class="btn" onclick="deleteCurrent()">Hapus Diary</button>
  </div>
</div>

<script>
function checkLogin(){
  if(passwordInput.value==="12354"){
    loginScreen.style.display="none";
    app.style.display="block";
  }else alert("Password salah");
}

firebase.initializeApp({
  apiKey:"AIzaSyB8jqDndij0mLi4zMqukKWRiEt4r6rh-D0",
  databaseURL:"https://abrdiary-4c946-default-rtdb.asia-southeast1.firebasedatabase.app"
});
const db=firebase.database();

/* DATE & TIME AUTO */
let manualDate=false, manualTime=false;
setInterval(()=>{
  const n=new Date();
  if(!manualDate) diaryDate.value=n.toISOString().slice(0,10);
  if(!manualTime) diaryTime.value=n.toTimeString().slice(0,5);
},1000);
diaryDate.onchange=()=>manualDate=true;
diaryTime.onchange=()=>manualTime=true;

/* TAG */
function loadTags(){
  db.ref("tags").once("value").then(s=>{
    tagList.innerHTML="";
    Object.keys(s.val()||{}).forEach(t=>{
      let b=document.createElement("span");
      b.className="tag-btn";
      b.innerText=t;
      b.onclick=()=>selectedTag.innerHTML=`<span class="tag-btn tag-selected">${t}</span>`;
      tagList.appendChild(b);
    });
  });
}

/* SAVE */
function saveDiary(){
  if(!selectedTag.innerText||!diaryText.value)
    return alert("Tag dan isi diary wajib diisi");
  db.ref("diaries").push({
    date:diaryDate.value,
    time:diaryTime.value,
    tag:selectedTag.innerText,
    text:diaryText.value
  }).then(()=>{diaryText.value="";loadDiary()});
}

/* LIST + SEARCH */
let currentKey="";
function loadDiary(){
  diaryList.innerHTML="";
  const q=(searchInput.value||"").toLowerCase();
  db.ref("diaries").once("value").then(s=>{
    let arr=Object.entries(s.val()||{}).map(([k,v])=>({key:k,...v}));
    arr.sort((a,b)=>(b.date+b.time).localeCompare(a.date+a.time));
    arr.forEach(x=>{
      if(q && !(x.text+x.tag).toLowerCase().includes(q)) return;
      let d=document.createElement("div");
      d.className="entry";
      d.innerHTML=`
        <div class="entry-date">${x.date} ${x.time} ‚Ä¢ ${x.tag}</div>
        <div class="entry-preview">${x.text.slice(0,60)}‚Ä¶</div>`;
      d.onclick=()=>{
        currentKey=x.key;
        modalContent.innerHTML=`<b>${x.date} ${x.time}</b><hr>${x.text}`;
        modal.style.display="flex";
      };
      diaryList.appendChild(d);
    });
  });
}
function deleteCurrent(){
  if(confirm("Yakin ingin menghapus diary ini?")){
    db.ref("diaries/"+currentKey).remove().then(()=>{
      modal.style.display="none";
      loadDiary();
    });
  }
}

loadTags();
loadDiary();
</script>

</body>
</html>
