<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AbrDiary - Diary Sederhana</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 800px; 
            margin: 0 auto; 
            padding: 20px; 
            background-color: #f9f9f9;
        }
        h1 { text-align: center; color: #333; }
        form { 
            background: white; 
            padding: 20px; 
            border-radius: 8px; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.1); 
            margin-bottom: 30px;
        }
        input, textarea { 
            width: 100%; 
            margin-bottom: 15px; 
            padding: 10px; 
            border: 1px solid #ccc; 
            border-radius: 4px; 
            box-sizing: border-box;
        }
        textarea { height: 150px; resize: vertical; }
        button { 
            padding: 12px 20px; 
            background: #4CAF50; 
            color: white; 
            border: none; 
            border-radius: 4px; 
            cursor: pointer; 
            font-size: 16px;
        }
        button:hover { background: #45a049; }
        .entry { 
            background: white; 
            padding: 15px; 
            margin-bottom: 15px; 
            border-radius: 8px; 
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .entry h3 { margin: 0 0 10px 0; color: #333; }
        .entry p { margin: 10px 0; }
        .tags { font-style: italic; color: #666; margin-bottom: 10px; }
        .delete-btn { 
            background: #f44336; 
            color: white; 
            padding: 6px 12px; 
            border: none; 
            border-radius: 4px; 
            cursor: pointer; 
            font-size: 14px;
        }
        .delete-btn:hover { background: #d32f2f; }
        .timestamp { font-size: 12px; color: #999; }
    </style>

    <!-- Firebase SDK (versi terbaru) -->
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-database-compat.js"></script>
</head>
<body>
    <h1>AbrDiary</h1>
    
    <form id="diaryForm">
        <input type="text" id="title" placeholder="Judul Diary" required>
        <textarea id="content" placeholder="Tulis isi diary kamu di sini..." required></textarea>
        <input type="text" id="tags" placeholder="Tag (pisahkan dengan koma, contoh: senang, libur, keluarga)">
        <button type="submit">Simpan Diary</button>
    </form>

    <h2>Daftar Diary</h2>
    <div id="diaryList"></div>

    <script>
        // Config Firebase milikmu (sudah saya masukkan)
        const firebaseConfig = {
            apiKey: "AIzaSyBSxNZ-L2fQfFoM6vWZnR2SkMoSTArQFhA",
            authDomain: "abrdiary-cf4a5.firebaseapp.com",
            databaseURL: "https://abrdiary-cf4a5-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "abrdiary-cf4a5",
            storageBucket: "abrdiary-cf4a5.firebasestorage.app",
            messagingSenderId: "478592228650",
            appId: "1:478592228650:web:48c7e3ffe9ab6f96a41253"
        };

        // Inisialisasi Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const diaryRef = database.ref('diaries');

        // Simpan diary baru
        document.getElementById('diaryForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const title = document.getElementById('title').value;
            const content = document.getElementById('content').value;
            const tagsInput = document.getElementById('tags').value;
            const tags = tagsInput ? tagsInput.split(',').map(tag => tag.trim()).filter(tag => tag) : [];

            diaryRef.push({
                title: title,
                content: content,
                tags: tags,
                timestamp: Date.now()
            });

            // Reset form
            document.getElementById('diaryForm').reset();
            alert('Diary berhasil disimpan!');
        });

        // Tampilkan semua diary (real-time)
        diaryRef.orderByChild('timestamp').on('value', (snapshot) => {
            const diaryList = document.getElementById('diaryList');
            diaryList.innerHTML = '';

            if (!snapshot.exists()) {
                diaryList.innerHTML = '<p>Belum ada diary. Tulis yang pertama yuk!</p>';
                return;
            }

            // Urutkan dari terbaru ke terlama
            const entries = [];
            snapshot.forEach((child) => {
                entries.push({
                    key: child.key,
                    data: child.val()
                });
            });

            entries.reverse().forEach((entry) => {
                const data = entry.data;
                const div = document.createElement('div');
                div.className = 'entry';
                
                const date = new Date(data.timestamp).toLocaleString('id-ID');
                
                div.innerHTML = `
                    <h3>${data.title}</h3>
                    <div class="timestamp">${date}</div>
                    <p>${data.content.replace(/\n/g, '<br>')}</p>
                    ${data.tags.length > 0 ? `<p class="tags">Tag: ${data.tags.join(', ')}</p>` : ''}
                    <button class="delete-btn" onclick="deleteEntry('${entry.key}')">Hapus</button>
                `;
                diaryList.appendChild(div);
            });
        });

        // Fungsi hapus
        function deleteEntry(key) {
            if (confirm('Yakin ingin menghapus diary ini?')) {
                diaryRef.child(key).remove();
            }
        }
    </script>
</body>
</html>
