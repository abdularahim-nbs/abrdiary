<script>
function loadDiary(){
    diaryList.innerHTML="";
    let q=searchInput.value.toLowerCase();
    let f=filterTag.value;

    db.ref("diaries").once("value").then(s=>{
        const data=s.val()||{};

        // ubah ke array
        let arr = Object.entries(data).map(([key,val])=>({
            key,
            ...val
        }));

        // SORT: TERBARU DI ATAS
        arr.sort((a,b)=> b.date.localeCompare(a.date));

        arr.forEach(x=>{
            let sText=(x.date+x.text+x.tag).toLowerCase();
            if(q && !sText.includes(q)) return;
            if(f && x.tag!==f) return;

            let p=x.text.length>70 ? x.text.slice(0,70)+"…" : x.text;
            let e=document.createElement("div");
            e.className="entry";
            e.innerHTML=`
              <span class="delete-x" onclick="deleteDiary('${x.key}')">×</span>
              <div class="entry-date">${x.date} • ${x.tag}</div>
              <div class="entry-preview">${p}</div>
            `;
            diaryList.appendChild(e);
        });
    });
}
</script>
